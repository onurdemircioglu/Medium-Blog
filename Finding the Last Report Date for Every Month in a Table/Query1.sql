DROP TABLE TEMP_TABLE;
CREATE TABLE TEMP_TABLE
(
    REPORT_DATE DATE,
    CUSTOMER_ID NUMBER,
    MANUEL_FILE_ID NUMBER
);
COMMIT;


SELECT * FROM TEMP_TABLE;

INSERT INTO TEMP_TABLE VALUES (TO_DATE('27122022','DDMMYYYY'), 100, 1 );
INSERT INTO TEMP_TABLE VALUES (TO_DATE('27122022','DDMMYYYY'), 200, 1 );
INSERT INTO TEMP_TABLE VALUES (TO_DATE('27122022','DDMMYYYY'), 300, 1 );
INSERT INTO TEMP_TABLE VALUES (TO_DATE('27122022','DDMMYYYY'), 400, 1 );

INSERT INTO TEMP_TABLE VALUES (TO_DATE('28122022','DDMMYYYY'), 100, 1 );
INSERT INTO TEMP_TABLE VALUES (TO_DATE('28122022','DDMMYYYY'), 200, 1 );
INSERT INTO TEMP_TABLE VALUES (TO_DATE('28122022','DDMMYYYY'), 300, 1 );
INSERT INTO TEMP_TABLE VALUES (TO_DATE('28122022','DDMMYYYY'), 400, 1 );

INSERT INTO TEMP_TABLE VALUES (TO_DATE('28122022','DDMMYYYY'), 100, 2 );
INSERT INTO TEMP_TABLE VALUES (TO_DATE('28122022','DDMMYYYY'), 200, 2 );
INSERT INTO TEMP_TABLE VALUES (TO_DATE('28122022','DDMMYYYY'), 300, 2 );
INSERT INTO TEMP_TABLE VALUES (TO_DATE('28122022','DDMMYYYY'), 400, 2 );
INSERT INTO TEMP_TABLE VALUES (TO_DATE('28122022','DDMMYYYY'), 500, 2 );

INSERT INTO TEMP_TABLE VALUES (TO_DATE('30012023','DDMMYYYY'), 100, 1 );
INSERT INTO TEMP_TABLE VALUES (TO_DATE('30012023','DDMMYYYY'), 200, 1 );
INSERT INTO TEMP_TABLE VALUES (TO_DATE('30012023','DDMMYYYY'), 300, 1 );
INSERT INTO TEMP_TABLE VALUES (TO_DATE('30012023','DDMMYYYY'), 400, 1 );

SELECT * FROM TEMP_TABLE;

WITH MY_DATE AS
(
SELECT TO_DATE('31122022','DDMMYYYY') AS MY_DATE FROM DUAL
)

SELECT *
FROM
    (
    SELECT A.*
            ,MAX(MANUEL_FILE_ID) OVER (PARTITION BY REPORT_DATE) MAX_MANUEL_FILE_ID -- FINDING THE LAST INSERTED DATA FOR EVERY REPORT DATE
            ,MAX(REPORT_DATE) OVER (PARTITION BY LAST_DAY(REPORT_DATE)) AS MAX_REPORT_DATE -- FINDING THE LAST REPORT DATE FOR EVERY (OR SELECTED) MONTH
    FROM TEMP_TABLE A
    WHERE 1=1
        AND REPORT_DATE <= (SELECT * FROM MY_DATE)  -- In Oracle Live SQL, substitution variables doesn't work. This is the workaround.
    ) A
WHERE 1=1
    AND MANUEL_FILE_ID = MAX_MANUEL_FILE_ID
    AND REPORT_DATE = MAX_REPORT_DATE
;


